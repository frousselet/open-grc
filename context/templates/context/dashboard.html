{% extends "base.html" %}

{% block title %}Gouvernance — Open GRC{% endblock %}

{% load help_tags %}

{% block content %}
<div class="d-flex align-items-center mb-4">
  <h1 class="mb-0">Gouvernance</h1>
</div>
{% help_modal "context.dashboard" %}

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card text-bg-primary">
      <div class="card-body">
        <h5 class="card-title">Périmètres</h5>
        <p class="display-6">{{ scope_count }}</p>
        {% for s in active_scopes %}
        <span class="badge bg-light text-dark me-1">{{ s.full_path }}</span>
        {% empty %}
        <small class="text-white-50">Aucun périmètre actif</small>
        {% endfor %}
        <div class="mt-2"><a href="{% url 'context:scope-list' %}" class="text-white">Voir tout</a></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-bg-info">
      <div class="card-body">
        <h5 class="card-title">Enjeux</h5>
        <p class="display-6">{{ issue_count }}</p>
        <div class="mt-2"><a href="{% url 'context:issue-list' %}" class="text-white">Voir tout</a></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-bg-success">
      <div class="card-body">
        <h5 class="card-title">Parties intéressées</h5>
        <p class="display-6">{{ stakeholder_count }}</p>
        <div class="mt-2"><a href="{% url 'context:stakeholder-list' %}" class="text-white">Voir tout</a></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-bg-warning">
      <div class="card-body">
        <h5 class="card-title">Objectifs</h5>
        <p class="display-6">{{ objective_count }}</p>
        <div class="mt-2"><a href="{% url 'context:objective-list' %}" class="text-dark">Voir tout</a></div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Analyses SWOT</h5>
        <p class="display-6">{{ swot_count }}</p>
        <a href="{% url 'context:swot-list' %}" class="btn btn-outline-primary btn-sm">Voir tout</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Rôles</h5>
        <p class="display-6">{{ role_count }}</p>
        <a href="{% url 'context:role-list' %}" class="btn btn-outline-primary btn-sm">Voir tout</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Activités</h5>
        <p class="display-6">{{ activity_count }}</p>
        <a href="{% url 'context:activity-list' %}" class="btn btn-outline-primary btn-sm">Voir tout</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Sites</h5>
        <p class="display-6">{{ site_count }}</p>
        <a href="{% url 'context:site-list' %}" class="btn btn-outline-primary btn-sm">Voir tout</a>
      </div>
    </div>
  </div>
</div>

{% if mandatory_roles_without_users %}
<div class="alert alert-danger">
  <h5>Alertes de conformité</h5>
  <ul class="mb-0">
    {% for role in mandatory_roles_without_users %}
    <li>Rôle obligatoire <strong>{{ role.name }}</strong> sans utilisateur affecté</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

{% if issues_by_impact %}
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">Enjeux par niveau d'impact</h5>
    <div class="d-flex gap-3">
      {% for item in issues_by_impact %}
      <span class="badge text-bg-{% if item.impact_level == 'critical' %}danger{% elif item.impact_level == 'high' %}warning{% elif item.impact_level == 'medium' %}info{% else %}secondary{% endif %} fs-6">
        {{ item.impact_level|title }} : {{ item.count }}
      </span>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
