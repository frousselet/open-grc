{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Governance" %} â€” Open GRC{% endblock %}

{% load help_tags %}

{% block content %}
<div class="d-flex align-items-center mb-4">
  <h1 class="mb-0">{% trans "Governance" %}</h1>
</div>
{% help_modal "context.dashboard" %}

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card text-bg-primary">
      <div class="card-body">
        <h5 class="card-title">{% trans "Scopes" %}</h5>
        <p class="display-6">{{ scope_count }}</p>
        {% for s in active_scopes %}
        <span class="badge bg-light text-dark me-1">{{ s.full_path }}</span>
        {% empty %}
        <small class="text-white-50">{% trans "No active scope" %}</small>
        {% endfor %}
        <div class="mt-2"><a href="{% url 'context:scope-list' %}" class="text-white">{% trans "View all" %}</a></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-bg-info">
      <div class="card-body">
        <h5 class="card-title">{% trans "Issues" %}</h5>
        <p class="display-6">{{ issue_count }}</p>
        <div class="mt-2"><a href="{% url 'context:issue-list' %}" class="text-white">{% trans "View all" %}</a></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-bg-success">
      <div class="card-body">
        <h5 class="card-title">{% trans "Stakeholders" %}</h5>
        <p class="display-6">{{ stakeholder_count }}</p>
        <div class="mt-2"><a href="{% url 'context:stakeholder-list' %}" class="text-white">{% trans "View all" %}</a></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-bg-warning">
      <div class="card-body">
        <h5 class="card-title">{% trans "Objectives" %}</h5>
        <p class="display-6">{{ objective_count }}</p>
        <div class="mt-2"><a href="{% url 'context:objective-list' %}" class="text-dark">{% trans "View all" %}</a></div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{% trans "SWOT analyses" %}</h5>
        <p class="display-6">{{ swot_count }}</p>
        <a href="{% url 'context:swot-list' %}" class="btn btn-outline-primary btn-sm">{% trans "View all" %}</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{% trans "Roles" %}</h5>
        <p class="display-6">{{ role_count }}</p>
        <a href="{% url 'context:role-list' %}" class="btn btn-outline-primary btn-sm">{% trans "View all" %}</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{% trans "Activities" %}</h5>
        <p class="display-6">{{ activity_count }}</p>
        <a href="{% url 'context:activity-list' %}" class="btn btn-outline-primary btn-sm">{% trans "View all" %}</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{% trans "Sites" %}</h5>
        <p class="display-6">{{ site_count }}</p>
        <a href="{% url 'context:site-list' %}" class="btn btn-outline-primary btn-sm">{% trans "View all" %}</a>
      </div>
    </div>
  </div>
</div>

{% if mandatory_roles_without_users %}
<div class="alert alert-danger">
  <h5>{% trans "Compliance alerts" %}</h5>
  <ul class="mb-0">
    {% for role in mandatory_roles_without_users %}
    <li>{% blocktrans with name=role.name %}Mandatory role <strong>{{ name }}</strong> with no assigned user{% endblocktrans %}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

{% if issues_by_impact %}
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">{% trans "Issues by impact level" %}</h5>
    <div class="d-flex gap-3">
      {% for item in issues_by_impact %}
      <span class="badge text-bg-{% if item.impact_level == 'critical' %}danger{% elif item.impact_level == 'high' %}warning{% elif item.impact_level == 'medium' %}info{% else %}secondary{% endif %} fs-6">
        {{ item.impact_level|title }} : {{ item.count }}
      </span>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
