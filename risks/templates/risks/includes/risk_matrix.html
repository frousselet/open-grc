{% load i18n %}
{% comment %}Reusable risk matrix grid. Expected: matrix (dict), title (str).{% endcomment %}
{% if matrix %}
<div class="risk-matrix-wrapper mb-4">
  <h6 class="text-center mb-3" style="font-weight:600;color:var(--text-secondary);font-size:.82rem;text-transform:uppercase;letter-spacing:.04em">{{ title }}</h6>
  <table style="border-collapse:separate; border-spacing:3px; width:100%;">
    {# ── Impact axis label ── #}
    <tr>
      <td></td>
      <td colspan="{{ matrix.impact_labels|length }}" style="text-align:center; font-size:.625rem; text-transform:uppercase; color:var(--text-muted); letter-spacing:.1em; padding:0 0 2px;">
        {% trans "Impact" %} &rarr;
      </td>
    </tr>
    {# ── Matrix rows ── #}
    {% for row in matrix.rows %}
    <tr>
      {% if forloop.first %}
      <td rowspan="{{ matrix.rows|length }}" style="vertical-align:middle; text-align:center; width:1.4em; padding:0;">
        <div style="writing-mode:vertical-lr; transform:rotate(180deg); font-size:.625rem; text-transform:uppercase; color:var(--text-muted); letter-spacing:.1em; white-space:nowrap;">
          {% trans "Likelihood" %} &rarr;
        </div>
      </td>
      {% endif %}
      {% for cell in row.cells %}
      <td class="risk-matrix-cell" style="background-color:{{ cell.color }}; color:{{ cell.text_color }}; text-align:center; vertical-align:middle; padding:10px 4px; min-width:90px; border-radius:var(--radius-sm);" title="{{ row.name }} / {{ cell.impact_name|default:cell.risk_level_name }}{% if cell.count %} — {{ cell.count }} risk(s){% endif %}">
        {% if cell.count %}
        <span class="risk-matrix-count">{{ cell.count }}</span>
        {% endif %}
        <span class="risk-matrix-level-name">{{ cell.risk_level_name }}</span>
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </table>
</div>
{% endif %}
