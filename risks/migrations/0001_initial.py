# Generated by Django 6.0.2 on 2026-02-27 16:31

import django.core.validators
import django.db.models.deletion
import simple_history.models
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('assets', '0004_rename_version_add_version'),
        ('context', '0007_scope_add_sites'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='HistoricalRiskCriteria',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('risk_matrix', models.JSONField(default=dict, verbose_name='Matrice de risque')),
                ('acceptance_threshold', models.PositiveIntegerField(default=0, verbose_name="Seuil d'acceptation")),
                ('is_default', models.BooleanField(default=False, verbose_name='Par défaut')),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('active', 'Actif'), ('archived', 'Archivé')], default='draft', max_length=20, verbose_name='Statut')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('scope', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='context.scope', verbose_name='Périmètre')),
            ],
            options={
                'verbose_name': 'historical Critère de risque',
                'verbose_name_plural': 'historical Critères de risque',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='HistoricalThreat',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(db_index=True, max_length=50, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('type', models.CharField(choices=[('deliberate', 'Délibérée'), ('accidental', 'Accidentelle'), ('environmental', 'Environnementale'), ('other', 'Autre')], max_length=20, verbose_name='Type')),
                ('origin', models.CharField(blank=True, choices=[('human_internal', 'Humaine interne'), ('human_external', 'Humaine externe'), ('natural', 'Naturelle'), ('technical', 'Technique'), ('other', 'Autre')], max_length=20, verbose_name='Origine')),
                ('category', models.CharField(blank=True, choices=[('malware', 'Logiciel malveillant'), ('social_engineering', 'Ingénierie sociale'), ('unauthorized_access', 'Accès non autorisé'), ('denial_of_service', 'Déni de service'), ('data_breach', 'Fuite de données'), ('physical_attack', 'Attaque physique'), ('espionage', 'Espionnage'), ('fraud', 'Fraude'), ('sabotage', 'Sabotage'), ('human_error', 'Erreur humaine'), ('system_failure', 'Défaillance système'), ('network_failure', 'Défaillance réseau'), ('power_failure', "Coupure d'alimentation"), ('natural_disaster', 'Catastrophe naturelle'), ('fire', 'Incendie'), ('water_damage', 'Dégât des eaux'), ('theft', 'Vol'), ('vandalism', 'Vandalisme'), ('supply_chain', "Chaîne d'approvisionnement"), ('insider_threat', 'Menace interne'), ('ransomware', 'Rançongiciel'), ('apt', 'Menace persistante avancée (APT)')], max_length=30, verbose_name='Catégorie')),
                ('typical_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance typique')),
                ('is_from_catalog', models.BooleanField(default=False, verbose_name='Issue du catalogue')),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive')], default='active', max_length=20, verbose_name='Statut')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('scope', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='context.scope', verbose_name='Périmètre')),
            ],
            options={
                'verbose_name': 'historical Menace',
                'verbose_name_plural': 'historical Menaces',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='HistoricalVulnerability',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(db_index=True, max_length=50, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('category', models.CharField(blank=True, choices=[('configuration_weakness', 'Faiblesse de configuration'), ('missing_patch', 'Correctif manquant'), ('design_flaw', 'Défaut de conception'), ('coding_error', 'Erreur de codage'), ('weak_authentication', 'Authentification faible'), ('insufficient_logging', 'Journalisation insuffisante'), ('lack_of_encryption', 'Absence de chiffrement'), ('physical_vulnerability', 'Vulnérabilité physique'), ('organizational_weakness', 'Faiblesse organisationnelle'), ('human_factor', 'Facteur humain'), ('obsolescence', 'Obsolescence'), ('insufficient_backup', 'Sauvegarde insuffisante'), ('network_exposure', 'Exposition réseau'), ('third_party_dependency', 'Dépendance tierce')], max_length=30, verbose_name='Catégorie')),
                ('severity', models.CharField(choices=[('low', 'Faible'), ('medium', 'Moyen'), ('high', 'Élevé'), ('critical', 'Critique')], default='medium', max_length=20, verbose_name='Sévérité')),
                ('affected_asset_types', models.JSONField(blank=True, default=list, verbose_name="Types d'actifs affectés")),
                ('cve_references', models.JSONField(blank=True, default=list, verbose_name='Références CVE')),
                ('remediation_guidance', models.TextField(blank=True, verbose_name='Guide de remédiation')),
                ('is_from_catalog', models.BooleanField(default=False, verbose_name='Issue du catalogue')),
                ('status', models.CharField(choices=[('identified', 'Identifiée'), ('confirmed', 'Confirmée'), ('mitigated', 'Atténuée'), ('accepted', 'Acceptée'), ('closed', 'Clôturée')], default='identified', max_length=20, verbose_name='Statut')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('scope', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='context.scope', verbose_name='Périmètre')),
            ],
            options={
                'verbose_name': 'historical Vulnérabilité',
                'verbose_name_plural': 'historical Vulnérabilités',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='Risk',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(max_length=50, unique=True, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('risk_source', models.CharField(choices=[('iso27005_analysis', 'Analyse ISO 27005'), ('ebios_strategic', 'Scénario stratégique EBIOS'), ('ebios_operational', 'Scénario opérationnel EBIOS'), ('incident', 'Incident'), ('audit', 'Audit'), ('compliance', 'Conformité'), ('manual', 'Saisie manuelle')], default='manual', max_length=30, verbose_name='Source du risque')),
                ('source_entity_id', models.UUIDField(blank=True, null=True, verbose_name='ID entité source')),
                ('source_entity_type', models.CharField(blank=True, max_length=100, verbose_name='Type entité source')),
                ('impact_confidentiality', models.BooleanField(default=False, verbose_name='Impact confidentialité')),
                ('impact_integrity', models.BooleanField(default=False, verbose_name='Impact intégrité')),
                ('impact_availability', models.BooleanField(default=False, verbose_name='Impact disponibilité')),
                ('initial_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance initiale')),
                ('initial_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact initial')),
                ('initial_risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque initial')),
                ('current_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance actuelle')),
                ('current_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact actuel')),
                ('current_risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque actuel')),
                ('residual_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance résiduelle')),
                ('residual_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact résiduel')),
                ('residual_risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque résiduel')),
                ('treatment_decision', models.CharField(choices=[('accept', 'Accepter'), ('mitigate', 'Réduire'), ('transfer', 'Transférer'), ('avoid', 'Éviter'), ('not_decided', 'Non décidé')], default='not_decided', max_length=20, verbose_name='Décision de traitement')),
                ('treatment_justification', models.TextField(blank=True, verbose_name='Justification du traitement')),
                ('priority', models.CharField(choices=[('low', 'Faible'), ('medium', 'Moyen'), ('high', 'Élevé'), ('critical', 'Critique')], default='low', max_length=20, verbose_name='Priorité')),
                ('status', models.CharField(choices=[('identified', 'Identifié'), ('analyzed', 'Analysé'), ('evaluated', 'Évalué'), ('treatment_planned', 'Traitement planifié'), ('treatment_in_progress', 'Traitement en cours'), ('treated', 'Traité'), ('accepted', 'Accepté'), ('closed', 'Clôturé'), ('monitoring', 'En surveillance')], default='identified', max_length=30, verbose_name='Statut')),
                ('review_date', models.DateField(blank=True, null=True, verbose_name='Date de revue')),
                ('affected_essential_assets', models.ManyToManyField(blank=True, related_name='risks', to='assets.essentialasset', verbose_name='Biens essentiels affectés')),
                ('affected_support_assets', models.ManyToManyField(blank=True, related_name='risks', to='assets.supportasset', verbose_name='Biens supports affectés')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('risk_owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='owned_risks', to=settings.AUTH_USER_MODEL, verbose_name='Propriétaire du risque')),
            ],
            options={
                'verbose_name': 'Risque',
                'verbose_name_plural': 'Risques',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='HistoricalRiskTreatmentPlan',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(db_index=True, max_length=50, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('treatment_type', models.CharField(choices=[('mitigate', 'Réduire'), ('transfer', 'Transférer'), ('avoid', 'Éviter')], max_length=20, verbose_name='Type de traitement')),
                ('expected_residual_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance résiduelle attendue')),
                ('expected_residual_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact résiduel attendu')),
                ('cost_estimate', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='Estimation du coût')),
                ('start_date', models.DateField(blank=True, null=True, verbose_name='Date de début')),
                ('target_date', models.DateField(blank=True, null=True, verbose_name='Date cible')),
                ('completion_date', models.DateField(blank=True, null=True, verbose_name='Date de réalisation')),
                ('progress_percentage', models.PositiveIntegerField(default=0, validators=[django.core.validators.MaxValueValidator(100)], verbose_name='Progression (%)')),
                ('status', models.CharField(choices=[('planned', 'Planifié'), ('in_progress', 'En cours'), ('completed', 'Terminé'), ('cancelled', 'Annulé'), ('overdue', 'En retard')], default='planned', max_length=20, verbose_name='Statut')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Responsable')),
                ('risk', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.risk', verbose_name='Risque')),
            ],
            options={
                'verbose_name': 'historical Plan de traitement',
                'verbose_name_plural': 'historical Plans de traitement',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='HistoricalRiskAcceptance',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('accepted_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'acceptation")),
                ('risk_level_at_acceptance', models.PositiveIntegerField(blank=True, null=True, verbose_name="Niveau de risque à l'acceptation")),
                ('justification', models.TextField(verbose_name='Justification')),
                ('conditions', models.TextField(blank=True, verbose_name='Conditions')),
                ('valid_until', models.DateField(blank=True, null=True, verbose_name="Valide jusqu'au")),
                ('review_date', models.DateField(blank=True, null=True, verbose_name='Date de revue')),
                ('status', models.CharField(choices=[('active', 'Active'), ('expired', 'Expirée'), ('revoked', 'Révoquée'), ('renewed', 'Renouvelée')], default='active', max_length=20, verbose_name='Statut')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('accepted_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Accepté par')),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('risk', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.risk', verbose_name='Risque')),
            ],
            options={
                'verbose_name': 'historical Acceptation de risque',
                'verbose_name_plural': 'historical Acceptations de risque',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='RiskAcceptance',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('accepted_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'acceptation")),
                ('risk_level_at_acceptance', models.PositiveIntegerField(blank=True, null=True, verbose_name="Niveau de risque à l'acceptation")),
                ('justification', models.TextField(verbose_name='Justification')),
                ('conditions', models.TextField(blank=True, verbose_name='Conditions')),
                ('valid_until', models.DateField(blank=True, null=True, verbose_name="Valide jusqu'au")),
                ('review_date', models.DateField(blank=True, null=True, verbose_name='Date de revue')),
                ('status', models.CharField(choices=[('active', 'Active'), ('expired', 'Expirée'), ('revoked', 'Révoquée'), ('renewed', 'Renouvelée')], default='active', max_length=20, verbose_name='Statut')),
                ('accepted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='risk_acceptances', to=settings.AUTH_USER_MODEL, verbose_name='Accepté par')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('risk', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='acceptances', to='risks.risk', verbose_name='Risque')),
            ],
            options={
                'verbose_name': 'Acceptation de risque',
                'verbose_name_plural': 'Acceptations de risque',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RiskAssessment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(max_length=50, unique=True, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('methodology', models.CharField(choices=[('iso27005', 'ISO 27005'), ('ebios_rm', 'EBIOS RM')], default='iso27005', max_length=20, verbose_name='Méthodologie')),
                ('assessment_date', models.DateField(blank=True, null=True, verbose_name="Date d'appréciation")),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('in_progress', 'En cours'), ('completed', 'Terminée'), ('validated', 'Validée'), ('archived', 'Archivée')], default='draft', max_length=20, verbose_name='Statut')),
                ('validated_at', models.DateTimeField(blank=True, null=True, verbose_name='Date de validation')),
                ('next_review_date', models.DateField(blank=True, null=True, verbose_name='Prochaine revue')),
                ('summary', models.TextField(blank=True, verbose_name='Synthèse')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('assessor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='risk_assessments_assessed', to=settings.AUTH_USER_MODEL, verbose_name='Appréciateur')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('scope', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='context.scope', verbose_name='Périmètre')),
                ('validated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='risk_assessments_validated', to=settings.AUTH_USER_MODEL, verbose_name='Validé par')),
            ],
            options={
                'verbose_name': 'Appréciation des risques',
                'verbose_name_plural': 'Appréciations des risques',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='risk',
            name='assessment',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='risks', to='risks.riskassessment', verbose_name='Appréciation'),
        ),
        migrations.CreateModel(
            name='HistoricalRisk',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(db_index=True, max_length=50, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('risk_source', models.CharField(choices=[('iso27005_analysis', 'Analyse ISO 27005'), ('ebios_strategic', 'Scénario stratégique EBIOS'), ('ebios_operational', 'Scénario opérationnel EBIOS'), ('incident', 'Incident'), ('audit', 'Audit'), ('compliance', 'Conformité'), ('manual', 'Saisie manuelle')], default='manual', max_length=30, verbose_name='Source du risque')),
                ('source_entity_id', models.UUIDField(blank=True, null=True, verbose_name='ID entité source')),
                ('source_entity_type', models.CharField(blank=True, max_length=100, verbose_name='Type entité source')),
                ('impact_confidentiality', models.BooleanField(default=False, verbose_name='Impact confidentialité')),
                ('impact_integrity', models.BooleanField(default=False, verbose_name='Impact intégrité')),
                ('impact_availability', models.BooleanField(default=False, verbose_name='Impact disponibilité')),
                ('initial_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance initiale')),
                ('initial_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact initial')),
                ('initial_risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque initial')),
                ('current_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance actuelle')),
                ('current_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact actuel')),
                ('current_risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque actuel')),
                ('residual_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance résiduelle')),
                ('residual_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact résiduel')),
                ('residual_risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque résiduel')),
                ('treatment_decision', models.CharField(choices=[('accept', 'Accepter'), ('mitigate', 'Réduire'), ('transfer', 'Transférer'), ('avoid', 'Éviter'), ('not_decided', 'Non décidé')], default='not_decided', max_length=20, verbose_name='Décision de traitement')),
                ('treatment_justification', models.TextField(blank=True, verbose_name='Justification du traitement')),
                ('priority', models.CharField(choices=[('low', 'Faible'), ('medium', 'Moyen'), ('high', 'Élevé'), ('critical', 'Critique')], default='low', max_length=20, verbose_name='Priorité')),
                ('status', models.CharField(choices=[('identified', 'Identifié'), ('analyzed', 'Analysé'), ('evaluated', 'Évalué'), ('treatment_planned', 'Traitement planifié'), ('treatment_in_progress', 'Traitement en cours'), ('treated', 'Traité'), ('accepted', 'Accepté'), ('closed', 'Clôturé'), ('monitoring', 'En surveillance')], default='identified', max_length=30, verbose_name='Statut')),
                ('review_date', models.DateField(blank=True, null=True, verbose_name='Date de revue')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('risk_owner', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Propriétaire du risque')),
                ('assessment', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.riskassessment', verbose_name='Appréciation')),
            ],
            options={
                'verbose_name': 'historical Risque',
                'verbose_name_plural': 'historical Risques',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='RiskCriteria',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('risk_matrix', models.JSONField(default=dict, verbose_name='Matrice de risque')),
                ('acceptance_threshold', models.PositiveIntegerField(default=0, verbose_name="Seuil d'acceptation")),
                ('is_default', models.BooleanField(default=False, verbose_name='Par défaut')),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('active', 'Actif'), ('archived', 'Archivé')], default='draft', max_length=20, verbose_name='Statut')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('scope', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='context.scope', verbose_name='Périmètre')),
            ],
            options={
                'verbose_name': 'Critère de risque',
                'verbose_name_plural': 'Critères de risque',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='riskassessment',
            name='risk_criteria',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assessments', to='risks.riskcriteria', verbose_name='Critères de risque'),
        ),
        migrations.CreateModel(
            name='HistoricalRiskAssessment',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(db_index=True, max_length=50, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('methodology', models.CharField(choices=[('iso27005', 'ISO 27005'), ('ebios_rm', 'EBIOS RM')], default='iso27005', max_length=20, verbose_name='Méthodologie')),
                ('assessment_date', models.DateField(blank=True, null=True, verbose_name="Date d'appréciation")),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('in_progress', 'En cours'), ('completed', 'Terminée'), ('validated', 'Validée'), ('archived', 'Archivée')], default='draft', max_length=20, verbose_name='Statut')),
                ('validated_at', models.DateTimeField(blank=True, null=True, verbose_name='Date de validation')),
                ('next_review_date', models.DateField(blank=True, null=True, verbose_name='Prochaine revue')),
                ('summary', models.TextField(blank=True, verbose_name='Synthèse')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('assessor', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Appréciateur')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('scope', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='context.scope', verbose_name='Périmètre')),
                ('validated_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Validé par')),
                ('risk_criteria', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.riskcriteria', verbose_name='Critères de risque')),
            ],
            options={
                'verbose_name': 'historical Appréciation des risques',
                'verbose_name_plural': 'historical Appréciations des risques',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='RiskTreatmentPlan',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(max_length=50, unique=True, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('treatment_type', models.CharField(choices=[('mitigate', 'Réduire'), ('transfer', 'Transférer'), ('avoid', 'Éviter')], max_length=20, verbose_name='Type de traitement')),
                ('expected_residual_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance résiduelle attendue')),
                ('expected_residual_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact résiduel attendu')),
                ('cost_estimate', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='Estimation du coût')),
                ('start_date', models.DateField(blank=True, null=True, verbose_name='Date de début')),
                ('target_date', models.DateField(blank=True, null=True, verbose_name='Date cible')),
                ('completion_date', models.DateField(blank=True, null=True, verbose_name='Date de réalisation')),
                ('progress_percentage', models.PositiveIntegerField(default=0, validators=[django.core.validators.MaxValueValidator(100)], verbose_name='Progression (%)')),
                ('status', models.CharField(choices=[('planned', 'Planifié'), ('in_progress', 'En cours'), ('completed', 'Terminé'), ('cancelled', 'Annulé'), ('overdue', 'En retard')], default='planned', max_length=20, verbose_name='Statut')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='owned_treatment_plans', to=settings.AUTH_USER_MODEL, verbose_name='Responsable')),
                ('risk', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='treatment_plans', to='risks.risk', verbose_name='Risque')),
            ],
            options={
                'verbose_name': 'Plan de traitement',
                'verbose_name_plural': 'Plans de traitement',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Threat',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(max_length=50, unique=True, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('type', models.CharField(choices=[('deliberate', 'Délibérée'), ('accidental', 'Accidentelle'), ('environmental', 'Environnementale'), ('other', 'Autre')], max_length=20, verbose_name='Type')),
                ('origin', models.CharField(blank=True, choices=[('human_internal', 'Humaine interne'), ('human_external', 'Humaine externe'), ('natural', 'Naturelle'), ('technical', 'Technique'), ('other', 'Autre')], max_length=20, verbose_name='Origine')),
                ('category', models.CharField(blank=True, choices=[('malware', 'Logiciel malveillant'), ('social_engineering', 'Ingénierie sociale'), ('unauthorized_access', 'Accès non autorisé'), ('denial_of_service', 'Déni de service'), ('data_breach', 'Fuite de données'), ('physical_attack', 'Attaque physique'), ('espionage', 'Espionnage'), ('fraud', 'Fraude'), ('sabotage', 'Sabotage'), ('human_error', 'Erreur humaine'), ('system_failure', 'Défaillance système'), ('network_failure', 'Défaillance réseau'), ('power_failure', "Coupure d'alimentation"), ('natural_disaster', 'Catastrophe naturelle'), ('fire', 'Incendie'), ('water_damage', 'Dégât des eaux'), ('theft', 'Vol'), ('vandalism', 'Vandalisme'), ('supply_chain', "Chaîne d'approvisionnement"), ('insider_threat', 'Menace interne'), ('ransomware', 'Rançongiciel'), ('apt', 'Menace persistante avancée (APT)')], max_length=30, verbose_name='Catégorie')),
                ('typical_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance typique')),
                ('is_from_catalog', models.BooleanField(default=False, verbose_name='Issue du catalogue')),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive')], default='active', max_length=20, verbose_name='Statut')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('scope', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='context.scope', verbose_name='Périmètre')),
            ],
            options={
                'verbose_name': 'Menace',
                'verbose_name_plural': 'Menaces',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='TreatmentAction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('description', models.TextField(verbose_name='Description')),
                ('target_date', models.DateField(blank=True, null=True, verbose_name='Date cible')),
                ('completion_date', models.DateField(blank=True, null=True, verbose_name='Date de réalisation')),
                ('status', models.CharField(choices=[('planned', 'Planifiée'), ('in_progress', 'En cours'), ('completed', 'Terminée'), ('cancelled', 'Annulée')], default='planned', max_length=20, verbose_name='Statut')),
                ('order', models.PositiveIntegerField(default=0, verbose_name='Ordre')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='treatment_actions', to=settings.AUTH_USER_MODEL, verbose_name='Responsable')),
                ('treatment_plan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='actions', to='risks.risktreatmentplan', verbose_name='Plan de traitement')),
            ],
            options={
                'verbose_name': 'Action de traitement',
                'verbose_name_plural': 'Actions de traitement',
                'ordering': ['order'],
            },
        ),
        migrations.CreateModel(
            name='Vulnerability',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('reference', models.CharField(max_length=50, unique=True, verbose_name='Référence')),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('category', models.CharField(blank=True, choices=[('configuration_weakness', 'Faiblesse de configuration'), ('missing_patch', 'Correctif manquant'), ('design_flaw', 'Défaut de conception'), ('coding_error', 'Erreur de codage'), ('weak_authentication', 'Authentification faible'), ('insufficient_logging', 'Journalisation insuffisante'), ('lack_of_encryption', 'Absence de chiffrement'), ('physical_vulnerability', 'Vulnérabilité physique'), ('organizational_weakness', 'Faiblesse organisationnelle'), ('human_factor', 'Facteur humain'), ('obsolescence', 'Obsolescence'), ('insufficient_backup', 'Sauvegarde insuffisante'), ('network_exposure', 'Exposition réseau'), ('third_party_dependency', 'Dépendance tierce')], max_length=30, verbose_name='Catégorie')),
                ('severity', models.CharField(choices=[('low', 'Faible'), ('medium', 'Moyen'), ('high', 'Élevé'), ('critical', 'Critique')], default='medium', max_length=20, verbose_name='Sévérité')),
                ('affected_asset_types', models.JSONField(blank=True, default=list, verbose_name="Types d'actifs affectés")),
                ('cve_references', models.JSONField(blank=True, default=list, verbose_name='Références CVE')),
                ('remediation_guidance', models.TextField(blank=True, verbose_name='Guide de remédiation')),
                ('is_from_catalog', models.BooleanField(default=False, verbose_name='Issue du catalogue')),
                ('status', models.CharField(choices=[('identified', 'Identifiée'), ('confirmed', 'Confirmée'), ('mitigated', 'Atténuée'), ('accepted', 'Acceptée'), ('closed', 'Clôturée')], default='identified', max_length=20, verbose_name='Statut')),
                ('affected_assets', models.ManyToManyField(blank=True, related_name='vulnerabilities', to='assets.supportasset', verbose_name='Actifs affectés')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('scope', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='context.scope', verbose_name='Périmètre')),
            ],
            options={
                'verbose_name': 'Vulnérabilité',
                'verbose_name_plural': 'Vulnérabilités',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='ISO27005Risk',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('threat_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance de la menace')),
                ('vulnerability_exposure', models.PositiveIntegerField(blank=True, null=True, verbose_name='Exposition de la vulnérabilité')),
                ('combined_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance combinée')),
                ('impact_confidentiality', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact confidentialité')),
                ('impact_integrity', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact intégrité')),
                ('impact_availability', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact disponibilité')),
                ('max_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact maximal')),
                ('risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque')),
                ('existing_controls', models.TextField(blank=True, verbose_name='Mesures existantes')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('affected_essential_assets', models.ManyToManyField(blank=True, related_name='iso27005_risks', to='assets.essentialasset', verbose_name='Biens essentiels affectés')),
                ('affected_support_assets', models.ManyToManyField(blank=True, related_name='iso27005_risks', to='assets.supportasset', verbose_name='Biens supports affectés')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('risk', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='iso27005_sources', to='risks.risk', verbose_name='Risque consolidé')),
                ('assessment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='iso27005_risks', to='risks.riskassessment', verbose_name='Appréciation')),
                ('threat', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='iso27005_risks', to='risks.threat', verbose_name='Menace')),
                ('vulnerability', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='iso27005_risks', to='risks.vulnerability', verbose_name='Vulnérabilité')),
            ],
            options={
                'verbose_name': 'Analyse ISO 27005',
                'verbose_name_plural': 'Analyses ISO 27005',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='HistoricalISO27005Risk',
            fields=[
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de création')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='Date de modification')),
                ('is_approved', models.BooleanField(default=True, verbose_name='Approuvé')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'approbation")),
                ('version', models.PositiveIntegerField(default=1, verbose_name='Version')),
                ('threat_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance de la menace')),
                ('vulnerability_exposure', models.PositiveIntegerField(blank=True, null=True, verbose_name='Exposition de la vulnérabilité')),
                ('combined_likelihood', models.PositiveIntegerField(blank=True, null=True, verbose_name='Vraisemblance combinée')),
                ('impact_confidentiality', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact confidentialité')),
                ('impact_integrity', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact intégrité')),
                ('impact_availability', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact disponibilité')),
                ('max_impact', models.PositiveIntegerField(blank=True, null=True, verbose_name='Impact maximal')),
                ('risk_level', models.PositiveIntegerField(blank=True, null=True, verbose_name='Niveau de risque')),
                ('existing_controls', models.TextField(blank=True, verbose_name='Mesures existantes')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('history_id', models.AutoField(primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('risk', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.risk', verbose_name='Risque consolidé')),
                ('assessment', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.riskassessment', verbose_name='Appréciation')),
                ('threat', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.threat', verbose_name='Menace')),
                ('vulnerability', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='risks.vulnerability', verbose_name='Vulnérabilité')),
            ],
            options={
                'verbose_name': 'historical Analyse ISO 27005',
                'verbose_name_plural': 'historical Analyses ISO 27005',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='RiskLevel',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('level', models.PositiveIntegerField(verbose_name='Niveau')),
                ('name', models.CharField(max_length=100, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('color', models.CharField(blank=True, max_length=7, verbose_name='Couleur')),
                ('requires_treatment', models.BooleanField(default=False, verbose_name='Nécessite un traitement')),
                ('criteria', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='risk_levels', to='risks.riskcriteria', verbose_name='Critère')),
            ],
            options={
                'verbose_name': 'Niveau de risque',
                'verbose_name_plural': 'Niveaux de risque',
                'ordering': ['level'],
                'unique_together': {('criteria', 'level')},
            },
        ),
        migrations.CreateModel(
            name='ScaleLevel',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('scale_type', models.CharField(choices=[('likelihood', 'Vraisemblance'), ('impact', 'Impact')], max_length=20, verbose_name="Type d'échelle")),
                ('level', models.PositiveIntegerField(verbose_name='Niveau')),
                ('name', models.CharField(max_length=100, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('color', models.CharField(blank=True, max_length=7, verbose_name='Couleur')),
                ('criteria', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='scale_levels', to='risks.riskcriteria', verbose_name='Critère')),
            ],
            options={
                'verbose_name': "Niveau d'échelle",
                'verbose_name_plural': "Niveaux d'échelle",
                'ordering': ['scale_type', 'level'],
                'unique_together': {('criteria', 'scale_type', 'level')},
            },
        ),
    ]
