{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Compliance" %} â€” Open GRC{% endblock %}

{% load help_tags %}

{% block content %}
<div class="d-flex align-items-center mb-4">
  <h1 class="mb-0">{% trans "Compliance" %}</h1>
</div>
{% help_modal "compliance.dashboard" %}

<div class="row g-3 mb-4">
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon accent"><i class="bi bi-journal-bookmark"></i></div>
      <div class="stat-card-label">{% trans "Frameworks" %}</div>
      <div class="stat-card-value">{{ framework_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:framework-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon info"><i class="bi bi-list-check"></i></div>
      <div class="stat-card-label">{% trans "Requirements" %}</div>
      <div class="stat-card-value">{{ requirement_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:requirement-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon success"><i class="bi bi-clipboard-check"></i></div>
      <div class="stat-card-label">{% trans "Assessments" %}</div>
      <div class="stat-card-value">{{ assessment_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:assessment-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon warning"><i class="bi bi-kanban"></i></div>
      <div class="stat-card-label">{% trans "Action plans" %}</div>
      <div class="stat-card-value">{{ action_plan_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:action-plan-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon accent"><i class="bi bi-arrow-left-right"></i></div>
      <div class="stat-card-label">{% trans "Mappings" %}</div>
      <div class="stat-card-value">{{ mapping_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:mapping-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="stat-card" style="border-left:3px solid var(--danger)">
      <div class="stat-card-icon danger"><i class="bi bi-x-circle"></i></div>
      <div class="stat-card-label">{% trans "Non-compliances" %}</div>
      <div class="stat-card-value" style="color:var(--danger)">{{ non_compliant_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:requirement-list' %}?compliance_status=non_compliant" class="stat-card-link" style="color:var(--danger)">{% trans "View" %}</a></div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="stat-card" style="border-left:3px solid var(--warning)">
      <div class="stat-card-icon warning"><i class="bi bi-clock-history"></i></div>
      <div class="stat-card-label">{% trans "Overdue plans" %}</div>
      <div class="stat-card-value" style="color:var(--warning)">{{ overdue_plans }}</div>
      <div class="stat-card-footer"><a href="{% url 'compliance:action-plan-list' %}?status=overdue" class="stat-card-link" style="color:var(--warning)">{% trans "View" %}</a></div>
    </div>
  </div>
</div>

{% if frameworks %}
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title"><i class="bi bi-journal-bookmark me-1" style="color:var(--accent)"></i> {% trans "Active frameworks" %}</h5>
    <div class="table-responsive mt-3">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{% trans "Reference" %}</th>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Type" %}</th>
            <th>{% trans "Compliance" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for fw in frameworks %}
          <tr>
            <td><a href="{% url 'compliance:framework-detail' fw.pk %}" style="color:var(--accent);text-decoration:none;font-weight:500">{{ fw.reference }}</a></td>
            <td>{{ fw.name }}</td>
            <td>{{ fw.get_type_display }}</td>
            <td>
              <div class="d-flex align-items-center gap-2">
                <div class="progress flex-grow-1" style="min-width:80px;height:.65rem">
                  <div class="progress-bar {% if fw.compliance_level >= 80 %}bg-success{% elif fw.compliance_level >= 50 %}bg-warning{% else %}bg-danger{% endif %}" style="width: {{ fw.compliance_level }}%"></div>
                </div>
                <span class="fw-semibold" style="font-size:.8rem;min-width:2.5rem;text-align:right;{% if fw.compliance_level >= 80 %}color:var(--success){% elif fw.compliance_level >= 50 %}color:var(--warning){% else %}color:var(--danger){% endif %}">{{ fw.compliance_level|floatformat:0 }}%</span>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
