{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Assets" %} — Open GRC{% endblock %}

{% load help_tags %}

{% block content %}
<div class="d-flex align-items-center mb-4">
  <h1 class="mb-0">{% trans "Assets" %}</h1>
</div>
{% help_modal "assets.dashboard" %}

<div class="row g-3 mb-4">
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon accent"><i class="bi bi-gem"></i></div>
      <div class="stat-card-label">{% trans "Essential assets" %}</div>
      <div class="stat-card-value">{{ essential_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'assets:essential-asset-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon info"><i class="bi bi-hdd-stack"></i></div>
      <div class="stat-card-label">{% trans "Support assets" %}</div>
      <div class="stat-card-value">{{ support_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'assets:support-asset-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon success"><i class="bi bi-share"></i></div>
      <div class="stat-card-label">{% trans "Dependencies" %}</div>
      <div class="stat-card-value">{{ dependency_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'assets:dependency-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon warning"><i class="bi bi-collection"></i></div>
      <div class="stat-card-label">{% trans "Groups" %}</div>
      <div class="stat-card-value">{{ group_count }}</div>
      <div class="stat-card-footer"><a href="{% url 'assets:group-list' %}" class="stat-card-link">{% trans "View all" %}</a></div>
    </div>
  </div>
</div>

{% if unsupported_essentials or orphan_supports or eol_assets %}
<div class="alert alert-danger mb-3">
  <div class="d-flex align-items-center mb-2">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <strong>{% trans "Alerts" %}</strong>
  </div>
  <ul class="mb-0">
    {% if unsupported_essentials %}
    <li>{{ unsupported_essentials }} {% trans "essential asset(s) without an associated support asset" %}</li>
    {% endif %}
    {% if orphan_supports %}
    <li>{{ orphan_supports }} {% trans "orphan support asset(s) (without essential asset)" %}</li>
    {% endif %}
    {% for sa in eol_assets %}
    <li><span class="ref">{{ sa.reference }}</span> {{ sa.name }}: {% trans "end of life exceeded" %} ({{ sa.end_of_life_date }})</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

{% if spof_count %}
<div class="alert alert-warning mb-3">
  <div class="d-flex align-items-center mb-2">
    <i class="bi bi-info-circle-fill me-2"></i>
    <strong>{% trans "Points of attention" %}</strong>
  </div>
  <p class="mb-1">{{ spof_count }} {% trans "single point(s) of failure (SPOF) detected across your dependencies." %}</p>
  <ul class="mb-0">
    {% if spof_detail.asset %}<li>{{ spof_detail.asset }} {% trans "asset dependency(ies)" %} — <a href="{% url 'assets:dependency-list' %}">{% trans "View" %}</a></li>{% endif %}
    {% if spof_detail.supplier %}<li>{{ spof_detail.supplier }} {% trans "supplier dependency(ies)" %} — <a href="{% url 'assets:supplier-dependency-list' %}">{% trans "View" %}</a></li>{% endif %}
    {% if spof_detail.site_asset %}<li>{{ spof_detail.site_asset }} {% trans "site–asset dependency(ies)" %} — <a href="{% url 'assets:site-asset-dependency-list' %}">{% trans "View" %}</a></li>{% endif %}
    {% if spof_detail.site_supplier %}<li>{{ spof_detail.site_supplier }} {% trans "site–supplier dependency(ies)" %} — <a href="{% url 'assets:site-supplier-dependency-list' %}">{% trans "View" %}</a></li>{% endif %}
  </ul>
</div>
{% endif %}

<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title"><i class="bi bi-pie-chart me-1" style="color:var(--accent)"></i> {% trans "Essential assets by type" %}</h5>
        <div class="d-flex gap-2 flex-wrap mt-3">
          {% for item in essential_by_type %}
          <span class="badge" style="background:var(--accent-soft);color:var(--accent);font-size:.82rem;padding:.4em .8em">{{ item.type }}: {{ item.count }}</span>
          {% empty %}
          <p style="color:var(--text-muted);font-size:.85rem">{% trans "No essential assets." %}</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title"><i class="bi bi-pie-chart me-1" style="color:var(--info)"></i> {% trans "Support assets by type" %}</h5>
        <div class="d-flex gap-2 flex-wrap mt-3">
          {% for item in support_by_type %}
          <span class="badge" style="background:var(--info-soft);color:var(--info);font-size:.82rem;padding:.4em .8em">{{ item.type }}: {{ item.count }}</span>
          {% empty %}
          <p style="color:var(--text-muted);font-size:.85rem">{% trans "No support assets." %}</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

{% if personal_data_count %}
<div class="alert alert-warning">
  <i class="bi bi-shield-exclamation me-2"></i>
  <strong>{{ personal_data_count }}</strong> {% trans "essential asset(s) containing personal data." %}
</div>
{% endif %}
{% endblock %}
